# Surge 回国优先完整配置（2025-10-15）
# 说明：默认国内直连（Domestic/DIRECT），仅必要场景走代理；Apple 走国内直连。

[General]
loglevel = notify
dns-server = 223.5.5.5, 119.29.29.29, 1.1.1.1, system
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local
exclude-simple-hostnames = true
internet-test-url = http://connectivitycheck.platform.hicloud.com/generate_204
proxy-test-url = http://latency-test.skk.moe/endpoint
test-timeout = 3
show-error-page-for-reject = true
udp-policy-not-supported-behaviour = REJECT

[Proxy]
# === 在此添加你的实际代理节点（示例保留，请替换为你自己的节点）===
# US-1 = ss, us.example.com, 443, encrypt-method=aes-256-gcm, password=your_password, tfo=true
# HK-1 = ss, hk.example.com, 443, encrypt-method=aes-256-gcm, password=your_password, tfo=true

[Proxy Group]
# 手动选择主组
Proxy = select, DIRECT  # 添加实际节点后修改为：Proxy = select, US-1, HK-1, DIRECT
# 国内直连优先组（便于按域名/列表命中）
Domestic = select, DIRECT
# 自动切换（可选）：按延迟从候选中选最优；未配置节点时保留为占位
Auto = fallback, DIRECT, 300  # 添加实际节点后修改为：Auto = fallback, US-1, HK-1, DIRECT, 300

[Rule]
# === 系统与局域网（最高优先级）===

RULE-SET,SYSTEM,DIRECT




# === 特定服务（回国直连）===
DOMAIN-SUFFIX,wechat.com,Domestic
DOMAIN-SUFFIX,alipay.com,Domestic

# === Apple（回国优先）===
RULE-SET,https://github.com/Blankwonder/surge-list/raw/master/apple.list,Domestic
DOMAIN-SUFFIX,apple.com,Domestic
DOMAIN-SUFFIX,icloud.com,Domestic

# === 广告拦截（置于服务细则之后，避免误伤）===
DOMAIN-SET,https://ruleset.skk.moe/List/domainset/reject.conf,REJECT
DOMAIN-SET,https://ruleset.skk.moe/List/domainset/reject_extra.conf,REJECT
RULE-SET,https://ruleset.skk.moe/List/non_ip/reject.conf,REJECT
RULE-SET,https://ruleset.skk.moe/List/non_ip/reject-no-drop.conf,REJECT-NO-DROP
RULE-SET,https://ruleset.skk.moe/List/non_ip/reject-drop.conf,REJECT-DROP
RULE-SET,https://ruleset.skk.moe/List/ip/reject.conf,REJECT-DROP

# === 中国大陆网络（放在广告规则之后）===
RULE-SET,https://ruleset.skk.moe/List/non_ip/domestic.conf,Domestic
RULE-SET,https://ruleset.skk.moe/List/ip/domestic.conf,Domestic
RULE-SET,https://ruleset.skk.moe/List/ip/china_ip.conf,Domestic

IP-CIDR,127.0.0.0/8,DIRECT
IP-CIDR,10.0.0.0/8,DIRECT
IP-CIDR,172.16.0.0/12,DIRECT
IP-CIDR,192.168.0.0/16,DIRECT

RULE-SET,LAN,DIRECT

# === GEOIP：回国代理 ===
RULE-SET,https://raw.githubusercontent.com/kkchan912/Surge-iOS/refs/heads/main/Rule-Set/ChinaASN.list,Domestic

AND,((SUBNET,TYPE:CELLULAR), (OR,((PROTOCOL,UDP), (PROTOCOL,QUIC))), (DEST-PORT,443)),REJECT-NO-DROP

# === 兜底：回国优先（默认直连）===
FINAL,DIRECT

[Host]
# === 屏蔽域名（温和模式便于诊断）===
*.tiktok.com = reject-no-drop

# === 国内服务使用国内DNS ===
*.taobao.com = server:223.5.5.5
*.tmall.com = server:223.5.5.5
*.alipay.com = server:223.5.5.5
*.alicdn.com = server:223.5.5.5
*.aliyun.com = server:223.5.5.5
*.jd.com = server:119.29.29.29
*.qq.com = server:119.29.29.29
*.tencent.com = server:119.29.29.29
*.weixin.com = server:119.29.29.29
*.douyin.com = server:119.29.29.29
*.snssdk.com = server:119.29.29.29
*.pstatp.com = server:119.29.29.29
*.amemv.com = server:119.29.29.29
*.bilibili.com = server:119.29.29.29
*.hdslb.com = server:119.29.29.29
*.music.163.com = server:119.29.29.29
*.163.com = server:119.29.29.29
*.weibo.cn = server:119.29.29.29
*.weibo.com = server:119.29.29.29

# === 海外服务使用海外DNS ===
*.google.com = server:8.8.8.8
*.youtube.com = server:8.8.8.8
*.googleapis.com = server:8.8.8.8
*.gstatic.com = server:8.8.8.8
*.github.com = server:1.1.1.1
*.githubusercontent.com = server:1.1.1.1
*.openai.com = server:1.1.1.1
*.cloudflare.com = server:1.1.1.1
*.apple.com = server:1.1.1.1
*.icloud.com = server:1.1.1.1

[URL Rewrite]
^https?:\/\/(ditu|maps)\.google\.cn https://maps.google.com 302
^https?:\/\/(www\.)?(g|google)\.cn https://www.google.com 302

[MITM]
# 仅对必要域名启用解密；更安全地保持证书校验开启
hostname = *.google.cn
skip-server-cert-verify = false
h2 = true
